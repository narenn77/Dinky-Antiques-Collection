<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dinky's Antiques Collection</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
h1 { margin: 0; }
a { text-decoration: none; color: #0073e6; }
a:hover { color: #005bb5; }
.jump-links { margin-bottom: 20px; text-align: center; }
.jump-links a { margin: 0 10px; }
.controls { text-align: center; margin-bottom: 20px; }
input, select { margin: 5px; padding: 5px; }

/* Sections */
.section { margin-bottom: 40px; }
.section h2 { text-align: left; border-bottom: 2px solid #ccc; padding-bottom: 5px; }

/* Horizontal scrolling galleries */
.gallery {
  display: flex;
  overflow-x: auto;
  gap: 15px;
  padding-bottom: 10px;
  scroll-behavior: smooth;
}
.gallery::-webkit-scrollbar { height: 8px; }
.gallery::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 4px; }

/* Gallery items */
.item {
  flex: 0 0 200px;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 10px;
  text-align: center;
  background: #f9f9f9;
  cursor: pointer;
  transition: transform 0.2s;
}
.item:hover { transform: scale(1.03); }

img { max-width: 100%; height: auto; border-radius: 4px; }
.desc { font-size: 0.9em; color: #555; margin-top: 5px; }

/* Popup modal */
#popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000; }
#popupContentContainer { background:#fff; padding:20px; border-radius:10px; max-width:95%; max-height:95%; overflow:auto; text-align:center; position:relative; }
#closePopup { position:absolute; top:10px; right:20px; cursor:pointer; font-size:28px; font-weight:bold; }
#popupContent img { max-width:90%; max-height:80vh; margin: 10px auto; display:block; }

/* Side-by-side for coin/currency */
@media (min-width:600px) {
  #popupContent img.side-by-side { max-width:45%; display:inline-block; vertical-align:top; margin:5px; }
}

/* Mobile adjustments */
@media (max-width:600px) {
  .item { flex: 0 0 150px; }
  .item .desc { display: none; }
}
</style>
</head>
<body>

<div class="header">
  <h1>Dinky's Antiques Collection</h1>
  <div>ðŸ“§ <a href="mailto:dnaphx@gmail.com">dnaphx@gmail.com</a></div>
</div>

<div class="jump-links">
  Jump to see: 
  <a href="#stamps">Stamps</a> | 
  <a href="#coins">Coins</a> | 
  <a href="#notes">Currency Notes</a>
</div>

<div class="controls">
  <input type="text" id="search" placeholder="Search by name or description...">
  <select id="filterYear"><option value="">All Years</option></select>
  <select id="filterCountry"><option value="">All Countries</option></select>
</div>

<!-- Sections -->
<div id="stamps" class="section">
  <h2>Stamps</h2>
  <div class="gallery" id="gallery-stamp"></div>
</div>

<div id="coins" class="section">
  <h2>Coins</h2>
  <div class="gallery" id="gallery-coin"></div>
</div>

<div id="notes" class="section">
  <h2>Currency Notes</h2>
  <div class="gallery" id="gallery-note"></div>
</div>

<!-- Popup Modal -->
<div id="popup">
  <div id="popupContentContainer">
    <span id="closePopup">&times;</span>
    <div id="popupContent"></div>
  </div>
</div>

<script>
let items = [];
const searchBox = document.getElementById("search");
const filterYear = document.getElementById("filterYear");
const filterCountry = document.getElementById("filterCountry");

const galleries = {
  "Stamp": document.getElementById("gallery-stamp"),
  "Coin": document.getElementById("gallery-coin"),
  "Currency Note": document.getElementById("gallery-note")
};

// Fetch JSON with cache-busting
fetch("data.json?v=" + new Date().getTime())
  .then(response => response.json())
  .then(data => {
    items = data;

    // Sort items by year ascending (oldest â†’ newest)
    items.sort((a, b) => a.year - b.year);

    populateFilters();
    displayItems();
  })
  .catch(error => console.error("Error loading data:", error));

function populateFilters() {
  const years = [...new Set(items.map(i=>i.year))].sort((a,b)=>a-b);
  years.forEach(y => { const o=document.createElement("option"); o.value=y; o.textContent=y; filterYear.appendChild(o); });
  const countries = [...new Set(items.map(i=>i.country))].sort();
  countries.forEach(c => { const o=document.createElement("option"); o.value=c; o.textContent=c; filterCountry.appendChild(o); });
}

function createItemHTML(item) {
  const div = document.createElement("div");
  div.className="item";
  div.innerHTML = `
    <img src="${item.img || item.imgFront}" alt="${item.name}">
    <p><strong>${item.name}</strong></p>
    <p>${item.year} (${item.type}) - ${item.country}</p>
    <p class="desc">${item.description}</p>
  `;
  div.addEventListener("click", ()=>openPopup(item));
  return div;
}

function displayItems() {
  const search = searchBox.value.toLowerCase();
  const year = filterYear.value;
  const country = filterCountry.value;

  Object.values(galleries).forEach(g => g.innerHTML = "");

  ["Stamp","Coin","Currency Note"].forEach(type => {
    const gallery = galleries[type];
    const filtered = items.filter(item =>
      item.type===type &&
      (item.name.toLowerCase().includes(search) || item.description.toLowerCase().includes(search)) &&
      (year==="" || item.year.toString()===year) &&
      (country==="" || item.country===country)
    );
    if(filtered.length===0) gallery.innerHTML="<p>No items found in this category.</p>";
    else filtered.forEach(item=>gallery.appendChild(createItemHTML(item)));
  });
}

// Popup functions
function openPopup(item){
  const popup = document.getElementById("popup");
  const content = document.getElementById("popupContent");

  if(item.type==="Stamp"){
    content.innerHTML=`
      <img src="${item.img}">
      <p style="margin-top:10px;">${item.description}</p>
    `;
  } else { // Coin or Currency Note
    content.innerHTML=`
      <p><strong>${item.name}</strong></p>
      <div style="display:flex; flex-wrap:wrap; justify-content:center; align-items:flex-start;">
        <img src="${item.imgFront}" class="side-by-side">
        <img src="${item.imgBack}" class="side-by-side">
      </div>
      <p style="margin-top:10px;">${item.description}</p>
    `;
  }
  popup.style.display="flex";
}

document.getElementById("closePopup").onclick=function(){document.getElementById("popup").style.display="none";}
document.getElementById("popup").onclick=function(e){if(e.target.id==="popup") this.style.display="none";}

searchBox.addEventListener("input", displayItems);
filterYear.addEventListener("change", displayItems);
filterCountry.addEventListener("change", displayItems);
</script>

</body>
</html>
