<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dinky Antiques Collection</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    h1 { margin: 0; }
    a { text-decoration: none; color: #0073e6; }
    a:hover { color: #005bb5; }
    .jump-links { margin-bottom: 20px; text-align: center; }
    .jump-links a { margin: 0 10px; }
    .controls { text-align: center; margin-bottom: 20px; }
    input, select { margin: 5px; padding: 5px; }
    .section { margin-bottom: 40px; }
    .section h2 { text-align: left; border-bottom: 2px solid #ccc; padding-bottom: 5px; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
    .item { border: 1px solid #ccc; border-radius: 8px; padding: 10px; text-align: center; background: #f9f9f9; }
    img { max-width: 100%; height: auto; border-radius: 4px; }
    .desc { font-size: 0.9em; color: #555; margin-top: 5px; }
  </style>
</head>
<body>

  <div class="header">
    <h1>Dinky's Antiques Collection</h1>
    <div>ðŸ“§ <a href="mailto:dnaphx@gmail.com">dnaphx@gmail.com</a></div>
  </div>

  <div class="jump-links">
    Jump to see: 
    <a href="#stamps">Stamps</a> | 
    <a href="#coins">Coins</a> | 
    <a href="#notes">Currency Notes</a>
  </div>

  <div class="controls">
    <input type="text" id="search" placeholder="Search by name or description...">
    <select id="filterYear">
      <option value="">All Years</option>
    </select>
    <select id="filterCountry">
      <option value="">All Countries</option>
    </select>
  </div>

  <!-- Sections -->
  <div id="stamps" class="section">
    <h2>Stamps</h2>
    <div class="gallery" id="gallery-stamp"></div>
  </div>

  <div id="coins" class="section">
    <h2>Coins</h2>
    <div class="gallery" id="gallery-coin"></div>
  </div>

  <div id="notes" class="section">
    <h2>Currency Notes</h2>
    <div class="gallery" id="gallery-note"></div>
  </div>

  <script>
    let items = [];

    const searchBox = document.getElementById("search");
    const filterYear = document.getElementById("filterYear");
    const filterCountry = document.getElementById("filterCountry");

    const galleries = {
      "Stamp": document.getElementById("gallery-stamp"),
      "Coin": document.getElementById("gallery-coin"),
      "Currency Note": document.getElementById("gallery-note")
    };

    // Fetch JSON with cache-busting
    fetch("data.json?v=" + new Date().getTime())
      .then(response => response.json())
      .then(data => {
        items = data;
        populateFilters();
        displayItems();
      })
      .catch(error => console.error("Error loading data:", error));

    function populateFilters() {
      const years = [...new Set(items.map(item => item.year))].sort((a,b)=>a-b);
      years.forEach(y => {
        const option = document.createElement("option");
        option.value = y;
        option.textContent = y;
        filterYear.appendChild(option);
      });

      const countries = [...new Set(items.map(item => item.country))].sort();
      countries.forEach(c => {
        const option = document.createElement("option");
        option.value = c;
        option.textContent = c;
        filterCountry.appendChild(option);
      });
    }

    function displayItems() {
      const search = searchBox.value.toLowerCase();
      const year = filterYear.value;
      const country = filterCountry.value;

      // Clear all galleries
      Object.values(galleries).forEach(g => g.innerHTML = "");

      items.forEach(item => {
        if (
          (item.name.toLowerCase().includes(search) || item.description.toLowerCase().includes(search)) &&
          (year === "" || item.year.toString() === year) &&
          (country === "" || item.country === country)
        ) {
          const html = `
            <div class="item">
              <img src="${item.img}" alt="${item.name}">
              <p><strong>${item.name}</strong></p>
              <p>${item.year} (${item.type}) - ${item.country}</p>
              <p class="desc">${item.description}</p>
            </div>
          `;
          if(galleries[item.type]) {
            galleries[item.type].innerHTML += html;
          }
        }
      });
    }

    searchBox.addEventListener("input", displayItems);
    filterYear.addEventListener("change", displayItems);
    filterCountry.addEventListener("change", displayItems);
  </script>

</body>
</html>
