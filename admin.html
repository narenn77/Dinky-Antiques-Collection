<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dinky's Collection - Admin Panel</title>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />

    <style>
        :root {
            --primary-color: #8B4513;
            --secondary-color: #D2B48C;
            --accent-color: #CD853F;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --text-dark: #2C1810;
            --text-light: #6B4423;
            --background: #FAF8F5;
            --white: #FFFFFF;
            --gray-light: #f8f9fa;
            --gray-medium: #e9ecef;
            --shadow: rgba(139, 69, 19, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }
        /* reset and base styles */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
        }
        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
        }
        /* Login screen styles omitted here for brevity - same as earlier */

        /* Sidebar menu update to include Manage Countries */
        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }
        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 1rem 2rem;
            color: var(--text-dark);
            text-decoration: none;
            transition: var(--transition);
            border-right: 3px solid transparent;
        }
        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: var(--gray-light);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* Add other existing styles here from the previously provided admin.html, unchanged */

        /* Additional styles for countries section */
        #countriesSection .form-container {
            max-width: 700px;
            margin: auto;
        }
    </style>
</head>
<body>
    <!-- Login Container (unchanged from previous) -->
    <div id="loginScreen" class="login-container">
        <form class="login-form" onsubmit="handleLogin(event)">
            <h1><i class="fas fa-shield-alt"></i> Admin Access</h1>
            <div id="errorMessage" class="error-message">Invalid credentials. Please try again.</div>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" required />
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" required />
            </div>
            <button type="submit" class="login-btn">
                <span id="loginText">Login</span>
                <span id="loginLoading" class="loading hidden"></span>
            </button>
            <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-light);">
                Default: admin / admin123
            </div>
        </form>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard">
        <header class="admin-header">
            <h1><i class="fas fa-gem"></i> Dinky's Admin Panel</h1>
            <div class="admin-nav">
                <button class="nav-btn" onclick="exportData()"><i class="fas fa-download"></i> Export Data</button>
                <button class="nav-btn" onclick="importData()"><i class="fas fa-upload"></i> Import Data</button>
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>
        <div class="admin-content">
            <!-- Sidebar -->
            <nav class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" class="menu-item active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" class="menu-item" data-section="stamps"><i class="fas fa-stamp"></i> Stamps</a></li>
                    <li><a href="#" class="menu-item" data-section="coins"><i class="fas fa-coins"></i> Coins</a></li>
                    <li><a href="#" class="menu-item" data-section="currency"><i class="fas fa-money-bill-wave"></i> Currency</a></li>
                    <li><a href="#" class="menu-item" data-section="add-item"><i class="fas fa-plus"></i> Add New Item</a></li>
                    <li><a href="#" class="menu-item" data-section="countries"><i class="fas fa-flag"></i> Manage Countries</a></li>
                    <li><a href="#" class="menu-item" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
            </nav>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Dashboard Section (unchanged) -->
                <section id="dashboardSection" class="content-section">
                    <!-- Content omitted for brevity, same as before -->
                </section>

                <!-- Stamps Section (unchanged) -->
                <section id="stampsSection" class="content-section hidden">
                    <!-- Content omitted for brevity -->
                </section>

                <!-- Coins Section (unchanged) -->
                <section id="coinsSection" class="content-section hidden">
                    <!-- Content omitted for brevity -->
                </section>

                <!-- Currency Section (unchanged) -->
                <section id="currencySection" class="content-section hidden">
                    <!-- Content omitted for brevity -->
                </section>

                <!-- Add/Edit Item Section (unchanged) -->
                <section id="add-itemSection" class="content-section hidden">
                    <!-- Content omitted for brevity -->
                </section>

                <!-- **New: Manage Countries Section** -->
                <section id="countriesSection" class="content-section hidden">
                    <div class="content-header">
                        <h2 class="content-title">Manage Countries</h2>
                        <button class="btn btn-primary" onclick="adminManager.showAddCountryForm()">
                            <i class="fas fa-plus"></i> Add Country
                        </button>
                    </div>
                    <div id="countriesList" class="form-container">
                        <table class="data-table" id="countriesTable">
                            <thead>
                                <tr><th>Name</th><th>Actions</th></tr>
                            </thead>
                            <tbody>
                                <!-- Dynamically populated -->
                            </tbody>
                        </table>
                    </div>
                    <div id="countryFormContainer" class="form-container hidden">
                        <h3 id="countryFormTitle">Add New Country</h3>
                        <form id="countryForm" onsubmit="adminManager.saveCountry(event)">
                            <div class="form-group">
                                <label for="countryNameInput">Country Name</label>
                                <input id="countryNameInput" type="text" required />
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="adminManager.cancelCountryEdit()">Cancel</button>
                                <button type="submit" class="btn btn-success">Save</button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Settings Section (unchanged) -->
                <section id="settingsSection" class="content-section hidden">
                    <!-- Content omitted for brevity -->
                </section>
            </main>
        </div>
    </div>

    <!-- Item Modal (unchanged) -->
    <div id="itemModal" class="modal">
        <!-- Content omitted for brevity -->
    </div>

    <script>
        class AdminManager {
            constructor() {
                this.currentSection = 'dashboard';
                this.currentEditId = null;
                this.currentEditCategory = null;
                this.collectionData = this.loadData();

                // Load countries or default country list
                this.countries = this.loadCountries();
                this.currentEditingCountryIndex = null;

                this.initializeAdmin();
            }

            loadData() {
                try {
                    const saved = localStorage.getItem('dinky-collection-data');
                    return saved ? JSON.parse(saved) : { stamps: [], coins: [], currency: [] };
                } catch {
                    return { stamps: [], coins: [], currency: [] };
                }
            }

            saveData() {
                localStorage.setItem('dinky-collection-data', JSON.stringify(this.collectionData));
                this.updateDashboard();
            }

            loadCountries() {
                try {
                    const saved = localStorage.getItem('dinky-countries');
                    if (saved) return JSON.parse(saved);
                    return ['USA', 'UK', 'Canada', 'Australia', 'Germany', 'France', 'Japan', 'China'];
                } catch {
                    return [];
                }
            }

            saveCountries() {
                localStorage.setItem('dinky-countries', JSON.stringify(this.countries));
            }

            renderCountries() {
                const tbody = document.querySelector('#countriesTable tbody');
                tbody.innerHTML = '';
                this.countries.forEach((country, i) => {
                    const tr = document.createElement('tr');

                    const nameTd = document.createElement('td');
                    nameTd.textContent = country;

                    const actionsTd = document.createElement('td');

                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-small btn-warning';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                    editBtn.onclick = () => this.editCountry(i);

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn btn-small btn-danger';
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    deleteBtn.onclick = () => this.deleteCountry(i);

                    actionsTd.appendChild(editBtn);
                    actionsTd.appendChild(deleteBtn);

                    tr.appendChild(nameTd);
                    tr.appendChild(actionsTd);

                    tbody.appendChild(tr);
                });
            }

            showAddCountryForm() {
                document.getElementById('countryFormTitle').textContent = 'Add New Country';
                document.getElementById('countryForm').reset();
                document.getElementById('countryFormContainer').classList.remove('hidden');
                document.getElementById('countriesList').classList.add('hidden');
                this.currentEditingCountryIndex = null;
            }

            cancelCountryEdit() {
                document.getElementById('countryFormContainer').classList.add('hidden');
                document.getElementById('countriesList').classList.remove('hidden');
                this.currentEditingCountryIndex = null;
            }

            saveCountry(event) {
                event.preventDefault();
                const countryName = document.getElementById('countryNameInput').value.trim();
                if (!countryName) {
                    alert('Country name cannot be empty');
                    return;
                }

                if (this.currentEditingCountryIndex !== null) {
                    this.countries[this.currentEditingCountryIndex] = countryName;
                } else {
                    if (this.countries.includes(countryName)) {
                        alert('Country already exists');
                        return;
                    }
                    this.countries.push(countryName);
                }
                this.saveCountries();
                this.renderCountries();
                this.cancelCountryEdit();

                // Dispatch event to notify main page to update filters
                window.dispatchEvent(new CustomEvent('countriesUpdated', {
                    detail: { countries: [...this.countries] }
                }));
            }

            editCountry(index) {
                this.currentEditingCountryIndex = index;
                document.getElementById('countryFormTitle').textContent = 'Edit Country';
                document.getElementById('countryNameInput').value = this.countries[index];
                document.getElementById('countryFormContainer').classList.remove('hidden');
                document.getElementById('countriesList').classList.add('hidden');
            }

            deleteCountry(index) {
                if (confirm(`Are you sure you want to delete "${this.countries[index]}"?`)) {
                    this.countries.splice(index, 1);
                    this.saveCountries();
                    this.renderCountries();
                    window.dispatchEvent(new CustomEvent('countriesUpdated', {
                        detail: { countries: [...this.countries] }
                    }));
                }
            }

            // Rest of the AdminManager methods go here (add/edit/delete stamp, coin, currency, etc.)
            // plus existing methods like updateDashboard, showSection, etc.,
            // unchanged from previous full admin.html provided

            // ... include your existing code for handling items and settings ...
            
            // For brevity, I am not repeating all existing methods here,
            // but when implementing, merge this countries code with full previous admin code.
            // Make sure to add: this.renderCountries(); call inside initializeAdmin();
            // and update country dropdown in add/edit item form in showSection('add-item').
        }

        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            document.getElementById('loginText').style.display = 'none';
            document.getElementById('loginLoading').classList.remove('hidden');

            setTimeout(() => {
                const savedPassword = localStorage.getItem('admin-password') || 'admin123';

                if (username === 'admin' && password === savedPassword) {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('adminDashboard').style.display = 'block';

                    window.adminManager = new AdminManager();
                    // Render countries on admin load
                    window.adminManager.renderCountries();
                } else {
                    document.getElementById('errorMessage').style.display = 'block';
                    document.getElementById('loginText').style.display = 'inline';
                    document.getElementById('loginLoading').classList.add('hidden');
                }
            }, 1000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('errorMessage').style.display = 'none';
            }
        }

        function showSection(section) {
            if(window.adminManager) {
                window.adminManager.showSection(section);
                
                // Update country dropdown on add-item form dynamically
                if(section === 'add-item') {
                    window.adminManager.updateCountryDropdown();
                }
            }
        }

        function saveItem(event) {
            if(window.adminManager) window.adminManager.saveItem(event);
        }

        function cancelEdit() {
            if(window.adminManager) window.adminManager.cancelEdit();
        }

        function exportData() {
            if(window.adminManager) window.adminManager.exportData();
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImportFile(event) {
            if(window.adminManager) window.adminManager.handleImportFile(event);
        }

        function clearAllData() {
            if(window.adminManager) window.adminManager.clearAllData();
        }

        function changePassword(event) {
            if(window.adminManager) window.adminManager.changePassword(event);
        }

        function closeModal() {
            if(window.adminManager) window.adminManager.closeModal();
        }
    </script>
</body>
</html>
